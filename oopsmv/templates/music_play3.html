<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI 음악 추천</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #000;
      color: white;
      text-align: center;
      padding: 30px;
    }
    select, button {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
    }
    .player {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h1>🎵 AI 음악 추천</h1>

  <div>
    <label>상황 선택:
      <select id="scenario">
        <option value="stressed|focus">💼 집중해서 일할 때</option>
        <option value="calm|study">📚 편안하게 공부할 때</option>
        <option value="stressed|work">🌙 야근할 때</option>
        <option value="energetic|exercise">🏃 신나게 운동할 때</option>
        <option value="happy|exercise">🌅 행복한 아침 조깅</option>
        <option value="stressed|exercise">💪 스트레스 풀러 운동</option>
        <option value="peaceful|relaxation">🛋️ 힐링이 필요할 때</option>
        <option value="calm|meditation">🧘 명상하며 마음 정리</option>
        <option value="melancholic|relaxation">😔 우울할 때 혼자만의 시간</option>
        <option value="happy|party">🎉 친구들과 즐거운 파티</option>
        <option value="romantic|social">💕 로맨틱한 데이트</option>
        <option value="dramatic|social">🍷 분위기 있는 저녁 모임</option>
        <option value="uplifting|commute">🚗 출근길 기분전환</option>
        <option value="peaceful|commute">🚌 퇴근길 힐링타임</option>
        <option value="peaceful|sleep">😴 잠들기 전 마음 진정</option>
        <option value="stressed|sleep">🌙 불면증으로 잠 못 이룰 때</option>
        <option value="dramatic|relaxation">✨ 감동적인 순간을 느끼고 싶을 때</option>
        <option value="energetic|focus">⚡ 에너지 충전이 필요할 때</option>
        <option value="happy|work">🌟 기분이 좋아서 뭔가 하고 싶을 때</option>
      </select>
    </label>
    <br/>
    <button onclick="recommend()">🎶 추천 받기</button>
  </div>

  <div class="player">
    <h2 id="track-title">추천 곡 제목</h2>
    <p id="track-artist">아티스트</p>
    <audio id="audio" controls style="width: 300px;"></audio>
  </div>

  <script>
    function recommend() {
      const scenario = document.getElementById("scenario").value;
      const [emotion, activity] = scenario.split("|");

      fetch("http://220.68.27.143:5000/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ emotion, activity })
      })
      .then(res => res.json())
      .then(params => {
        const url = new URL("https://api.jamendo.com/v3.0/tracks/");
        params.client_id = "709fa152";  // 테스트용 client_id
        for (const key in params) {
          url.searchParams.append(key, params[key]);
        }
        return fetch(url);
      })
      .then(res => res.json())
      .then(data => {
        const track = data.results?.[0];
        if (track) {
          document.getElementById("track-title").textContent = track.name;
          document.getElementById("track-artist").textContent = track.artist_name;
          document.getElementById("audio").src = track.audio;
          document.getElementById("audio").play();
        } else {
          alert("추천 결과가 없습니다.");
        }
      })
      .catch(err => {
        console.error(err);
        alert("추천 요청 중 오류가 발생했습니다.");
      });
    }
  </script>
</body>
</html>
