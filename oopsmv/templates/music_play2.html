<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI ìŒì•… ì¶”ì²œ</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #000;
      color: white;
      text-align: center;
      padding: 30px;
    }
    select, button {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
    }
    .player {
      margin-top: 30px;
    }
    #analysis-output {
      white-space: pre-wrap;
      text-align: left;
      background: #111;
      padding: 20px;
      margin-top: 30px;
      border-radius: 10px;
      font-size: 0.9rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    .track-controls {
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h1>ğŸµìŒì•… ì¶”ì²œğŸµ</h1>

  <div>
    <label>ìƒí™©:
      <select id="scenario">
        <option value="stressed|focus">ğŸ’¼ ì§‘ì¤‘í•´ì„œ ì¼í•  ë•Œ</option>
        <option value="calm|study">ğŸ“š í¸ì•ˆí•˜ê²Œ ê³µë¶€í•  ë•Œ</option>
        <option value="stressed|work">ğŸŒ™ ì•¼ê·¼í•  ë•Œ</option>
        <option value="energetic|exercise">ğŸƒ ì‹ ë‚˜ê²Œ ìš´ë™í•  ë•Œ</option>
        <option value="happy|exercise">ğŸŒ… í–‰ë³µí•œ ì•„ì¹¨ ì¡°ê¹…</option>
        <option value="stressed|exercise">ğŸ’ª ìŠ¤íŠ¸ë ˆìŠ¤ í’€ëŸ¬ ìš´ë™</option>
        <option value="peaceful|relaxation">ğŸ›‹ï¸ íë§ì´ í•„ìš”í•  ë•Œ</option>
        <option value="calm|meditation">ğŸ§˜ ëª…ìƒí•˜ë©° ë§ˆìŒ ì •ë¦¬</option>
        <option value="melancholic|relaxation">ğŸ˜” ìš°ìš¸í•  ë•Œ í˜¼ìë§Œì˜ ì‹œê°„</option>
        <option value="happy|party">ğŸ‰ ì¹œêµ¬ë“¤ê³¼ ì¦ê±°ìš´ íŒŒí‹°</option>
        <option value="romantic|social">ğŸ’• ë¡œë§¨í‹±í•œ ë°ì´íŠ¸</option>
        <option value="dramatic|social">ğŸ· ë¶„ìœ„ê¸° ìˆëŠ” ì €ë… ëª¨ì„</option>
        <option value="uplifting|commute">ğŸš— ì¶œê·¼ê¸¸ ê¸°ë¶„ì „í™˜</option>
        <option value="peaceful|commute">ğŸšŒ í‡´ê·¼ê¸¸ íë§íƒ€ì„</option>
        <option value="peaceful|sleep">ğŸ˜´ ì ë“¤ê¸° ì „ ë§ˆìŒ ì§„ì •</option>
        <option value="stressed|sleep">ğŸŒ™ ë¶ˆë©´ì¦ìœ¼ë¡œ ì  ëª» ì´ë£° ë•Œ</option>
        <option value="dramatic|relaxation">âœ¨ ê°ë™ì ì¸ ìˆœê°„ì„ ëŠë¼ê³  ì‹¶ì„ ë•Œ</option>
        <option value="energetic|focus">âš¡ ì—ë„ˆì§€ ì¶©ì „ì´ í•„ìš”í•  ë•Œ</option>
        <option value="happy|work">ğŸŒŸ ê¸°ë¶„ì´ ì¢‹ì•„ì„œ ë­”ê°€ í•˜ê³  ì‹¶ì„ ë•Œ</option>
      </select>
    </label>
    
    <br/>
    <label>ë‚ ì”¨:
      <select id="weather">
        <option value="sunny">â˜€ï¸ ë§‘ìŒ</option>
        <option value="cloudy">â˜ï¸ íë¦¼</option>
        <option value="rainy">ğŸŒ§ï¸ ë¹„</option>
        <option value="snowy">â„ï¸ ëˆˆ</option>
        <option value="windy">ğŸ’¨ ë°”ëŒ</option>
      </select>
    </label>
    
    <br/>
    <button onclick="recommend()">ğŸ¶ ì¶”ì²œ ë°›ê¸°</button>
  </div>

  <div class="player">
    <h2 id="track-title">ì¶”ì²œ ê³¡ ì œëª©</h2>
    <p id="track-artist">ì•„í‹°ìŠ¤íŠ¸</p>
    <audio id="audio" controls style="width: 300px;"></audio>

    <div class="track-controls">
      <button onclick="prevTrack()">â®ï¸ ì´ì „ ê³¡</button>
      <button onclick="nextTrack()">â­ï¸ ë‹¤ìŒ ê³¡</button>
    </div>
  </div>

  <!-- ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
<div style="margin-top: 20px; text-align: center;">
    <a href="front1.html" style="
      display: inline-block;
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
    ">
      ë©”ì¸ í˜ì´ì§€ë¡œ
    </a>
  </div>



  <script>
    let allTracks = [];
    let currentTrackIndex = 0;

    function recommend() {
      const scenario = document.getElementById("scenario");
      const weather = document.getElementById("weather");
  
      if (!scenario || !weather) {
        alert("ì„ íƒ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
  
      const [emotion, activity] = scenario.value.split("|");
  
      console.log("ğŸ” ì „ì†¡í•  ì¶”ì²œ ìš”ì²­ ë°ì´í„°:", { emotion, activity, weather: weather.value });
  
      fetch("http://localhost:5000/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ emotion, activity, weather: weather.value })
      })
      .then(res => {
        console.log("âœ… ì„œë²„ ì‘ë‹µ ìƒíƒœì½”ë“œ:", res.status);
        return res.json();
      })
      .then(data => {
  console.log("ğŸµ ì„œë²„ ì‘ë‹µ ë°ì´í„°:", data);

  const analysis = data.analysis;
  const tracks = data.tracks;

  if (!tracks || tracks.length === 0) {
    alert("ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.");
    return;
  }

  // ì „ì—­ ì €ì¥ ë° ì´ˆê¸° ì¬ìƒ
  allTracks = tracks;
  currentTrackIndex = 0;
  updateTrack();

  // ğŸ” ë¦¬í¬íŠ¸ëŠ” ë¸Œë¼ìš°ì €ê°€ ì•„ë‹Œ ì½˜ì†”ì—ë§Œ ì¶œë ¥
  console.log("ğŸ“Š ë¶„ì„ ë¦¬í¬íŠ¸ (í„°ë¯¸ë„ ì¶œë ¥ìš©):\n" + analysis);
  // document.getElementById("analysis-output").textContent = analysis; // ğŸ‘‰ ì œê±°
})

      .catch(err => {
        console.error("âŒ ì˜¤ë¥˜:", err);
        alert("ì¶”ì²œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
    }

    function updateTrack() {
      const track = allTracks[currentTrackIndex];
      if (!track) return;

      document.getElementById("track-title").textContent = track.name;
      document.getElementById("track-artist").textContent = track.artist_name;
      document.getElementById("audio").src = track.audio;
      document.getElementById("audio").play();
    }

    function nextTrack() {
      if (currentTrackIndex < allTracks.length - 1) {
        currentTrackIndex++;
        updateTrack();
      } else {
        alert("ğŸµ ë§ˆì§€ë§‰ ê³¡ì…ë‹ˆë‹¤.");
      }
    }

    function prevTrack() {
      if (currentTrackIndex > 0) {
        currentTrackIndex--;
        updateTrack();
      } else {
        alert("ğŸµ ì²« ë²ˆì§¸ ê³¡ì…ë‹ˆë‹¤.");
      }
    }
  </script>

</body>
</html>
