<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI 음악 추천</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #000;
      color: white;
      text-align: center;
      padding: 30px;
    }
    select, button {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
    }
    .player {
      margin-top: 30px;
    }
    #analysis-output {
      white-space: pre-wrap;
      text-align: left;
      background: #111;
      padding: 20px;
      margin-top: 30px;
      border-radius: 10px;
      font-size: 0.9rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>

  <h1>🎵 AI 음악 추천</h1>

  <div>
    <label>상황:
      <select id="scenario">
        <option value="stressed|focus">💼 집중해서 일할 때</option>
        <option value="calm|study">📚 편안하게 공부할 때</option>
        <option value="stressed|work">🌙 야근할 때</option>
        <option value="energetic|exercise">🏃 신나게 운동할 때</option>
        <option value="happy|exercise">🌅 행복한 아침 조깅</option>
        <option value="stressed|exercise">💪 스트레스 풀러 운동</option>
        <option value="peaceful|relaxation">🛋️ 힐링이 필요할 때</option>
        <option value="calm|meditation">🧘 명상하며 마음 정리</option>
        <option value="melancholic|relaxation">😔 우울할 때 혼자만의 시간</option>
        <option value="happy|party">🎉 친구들과 즐거운 파티</option>
        <option value="romantic|social">💕 로맨틱한 데이트</option>
        <option value="dramatic|social">🍷 분위기 있는 저녁 모임</option>
        <option value="uplifting|commute">🚗 출근길 기분전환</option>
        <option value="peaceful|commute">🚌 퇴근길 힐링타임</option>
        <option value="peaceful|sleep">😴 잠들기 전 마음 진정</option>
        <option value="stressed|sleep">🌙 불면증으로 잠 못 이룰 때</option>
        <option value="dramatic|relaxation">✨ 감동적인 순간을 느끼고 싶을 때</option>
        <option value="energetic|focus">⚡ 에너지 충전이 필요할 때</option>
        <option value="happy|work">🌟 기분이 좋아서 뭔가 하고 싶을 때</option>
      </select>
    </label>
    
    <br/>
    <label>날씨:
      <select id="weather">
        <option value="sunny">☀️ 맑음</option>
        <option value="cloudy">☁️ 흐림</option>
        <option value="rainy">🌧️ 비</option>
        <option value="snowy">❄️ 눈</option>
        <option value="windy">💨 바람</option>
      </select>
    </label>
    
    <br/>
    <button onclick="recommend()">🎶 추천 받기</button>
  </div>

  <div class="player">
    <h2 id="track-title">추천 곡 제목</h2>
    <p id="track-artist">아티스트</p>
    <audio id="audio" controls style="width: 300px;"></audio>
  </div>

  <div id="analysis-output"></div>

  <script>
    function recommend() {
      const scenario = document.getElementById("scenario");
      const weather = document.getElementById("weather");
  
      if (!scenario || !weather) {
        alert("선택 항목을 찾을 수 없습니다.");
        return;
      }
  
      const [emotion, activity] = scenario.value.split("|");
  
      console.log("🔍 전송할 추천 요청 데이터:", { emotion, activity, weather: weather.value });
  
      fetch("http://localhost:5000/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ emotion, activity, weather: weather.value })
      })
      .then(res => {
        console.log("✅ 서버 응답 상태코드:", res.status);
        return res.json();
      })
      .then(params => {
  console.log("✅ 추천 결과 (params):");
  for (const [key, value] of Object.entries(params)) {
    console.log(`  ${key}: ${value}`);
  }

  // ✅ Jamendo API URL 구성
  const url = new URL("https://api.jamendo.com/v3.0/tracks/");
  url.searchParams.set("client_id", "602b9767");

  for (const [key, value] of Object.entries(params)) {
    if (key !== "client_id") {
      url.searchParams.set(key, value);
    }
  }

  const fullURL = url.toString();
  console.log("🎧 Jamendo 요청 URL:", fullURL);

  return fetch(fullURL);
})

      .then(res => res.json())
      .then(data => {
        console.log("🎵 Jamendo 응답 결과:", data);
        const track = data.results?.[0];
        if (track) {
          document.getElementById("track-title").textContent = track.name;
          document.getElementById("track-artist").textContent = track.artist_name;
          document.getElementById("audio").src = track.audio;
          document.getElementById("audio").play();
        } else {
          alert("추천 결과가 없습니다. 다른 조건으로 시도해보세요.");
        }
      })
      .catch(err => {
        console.error("❌ 오류:", err);
        alert("추천 요청 중 오류가 발생했습니다.");
      });
    }
  </script>
  
  

</body>
</html>
