<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oops, My Vibe!</title>
  <link rel="stylesheet" href="front1_style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
</head>
<body>

  <div class="container">
    <h1 class="title">Oops, My Vibe!</h1>
    <button class="play-button"><span>play</span></button>
  </div>

  <!-- âœ… ë¡œê·¸ì¸ ì˜ì—­ (ë“œë¡­ë‹¤ìš´ í¬í•¨) -->
  <div class="login-wrapper" id="loginWrapper" style="position: absolute; top: 20px; right: 30px;">
    <div class="login-text" id="loginDisplay">ë¡œê·¸ì¸</div>
    <div class="user-dropdown" id="userDropdown" style="display: none; position: absolute; right: 0; top: 100%; background: white; border: 1px solid #ccc; border-radius: 4px;">
      <button id="goMypage">ë§ˆì´í˜ì´ì§€</button>
      <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <div id="loginModal" class="login-modal">
    <div class="login-modal-content">
      <button id="closeLoginModal" class="close-login-modal">Ã—</button>
      <h2 class="modal-title">ë¡œê·¸ì¸</h2>
      <form id="loginForm">

        <input type="text" name="username" class="modal-input" placeholder="id" required />
        <input type="password" name="password" class="modal-input" placeholder="Password" required />
        <button type="submit" class="login-submit">ë¡œê·¸ì¸</button>
      </form>
      <div class="modal-footer">
        <span class="footer-text">ê³„ì •ì´ ì—†ë‚˜ìš”?</span>
        <span id="openSignup" class="footer-link">íšŒì›ê°€ì…</span>
      </div>
    </div>
  </div>

  <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
  <div id="signupModal" class="login-modal">
    <div class="login-modal-content">
      <button id="closeSignupModal" class="close-login-modal">Ã—</button>
      <h2 class="modal-title">íšŒì›ê°€ì…</h2>
      <form action="/register" method="POST">
        <input type="text" name="nickname" class="modal-input" placeholder="Username" required />
        <input type="text" name="username" class="modal-input" placeholder="id" required />
        <input type="password" name="password" class="modal-input" placeholder="Password" required />
        <input type="password" name="confirm" class="modal-input" placeholder="Password í™•ì¸" required />
        <button type="submit" class="login-submit">ê°€ì…í•˜ê¸°</button>
      </form>
    </div>
  </div>

  <!-- ì‚¬ì´ë“œë°” ë° ì˜¤ë²„ë ˆì´ -->
  <input type="checkbox" id="menuToggle" class="menu-toggle"/>
  <label for="menuToggle" class="menu-icon" data-open="â˜°" data-close="âœ•"></label>
  <div class="overlay"></div>

  <div class="sidebar">
    <div class="tag-list">
      <div class="tag">íŒğŸ¤</div>
      <div class="tag">ë¡ğŸ¸</div>
      <div class="tag">í™í•©ğŸ§</div>
      <div class="tag">R&BğŸ¹</div>
      <div class="tag">EDMğŸ›ï¸</div>
      <div class="tag">ì¬ì¦ˆğŸ·</div>
      <div class="tag">í‘í¬ğŸª§</div>
      <div class="tag">K-Popâœ¨</div>
      <div class="tag">ë°œë¼ë“œğŸ’§</div>
      <div class="tag">ì¸ë””ğŸ˜</div>
      <div class="tag">ë©”íƒˆğŸ¤˜</div>
      <div class="tag">í´ë˜ì‹ğŸ»</div>
    </div>
  </div>

  <!-- <button id="locBtn">ğŸ“ ë‚´ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button> -->

  <!-- ì•ˆë‚´ íŒì—… -->
  <div id="guidePopup" class="guide-popup">
    <button id="closePopup" class="close-btn">Ã—</button>
    <h3>ğŸµ ì§€ê¸ˆ ì´ ìˆœê°„, ë”± ë§ëŠ” ìŒì•…ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤! ğŸµ</h3>
    <span class="star" style="left: 5%; animation-delay: 0s;">â­ï¸</span>
    <span class="star" style="left: 20%; animation-delay: 0.5s;">â­ï¸</span>
    <span class="star" style="left: 40%; animation-delay: 1.1s;">â­ï¸</span>
    <span class="star" style="left: 60%; animation-delay: 1.8s;">â­ï¸</span>
    <span class="star" style="left: 80%; animation-delay: 1.5s;">â­ï¸</span>
    <span class="star" style="left: 95%; animation-delay: 0.7s;">â­ï¸</span>
    <p>í˜„ì¬ ë‚ ì”¨ì™€ ì‹œê°„ëŒ€ë¥¼ ë°˜ì˜í•´ ìµœì ì˜ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ íë ˆì´ì…˜í•©ë‹ˆë‹¤.<br>
    â˜€ï¸ ìƒì¾Œí•œ ì•„ì¹¨ë¶€í„° ğŸŒ™ ê°ì„±ì ì¸ ë°¤ê¹Œì§€, ì–¸ì œë“  ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ìŒì•…ì„ ë§Œë‚˜ë³´ì„¸ìš”!</p>
    <p>ğŸ” <strong>ì‹¤ì‹œê°„ ë§ì¶¤ ì¶”ì²œ | ë¬´ë“œ ê¸°ë°˜ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</strong><br>
      <a href="/music_form" class="listen-link">ğŸ§ ì§€ê¸ˆ ë°”ë¡œ ë“¤ì–´ë³´ì„¸ìš”!</a>

    </p>
  </div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ìŒì•… ì¶”ì²œ íŒì—… ì œì–´
    const playButton = document.querySelector('.play-button');
    const guidePopup = document.getElementById('guidePopup');
    const closePopupButton = document.getElementById('closePopup');

    guidePopup.style.display = 'none';
    playButton.addEventListener('click', () => guidePopup.style.display = 'block');
    closePopupButton.addEventListener('click', () => guidePopup.style.display = 'none');
  </script>

<script>
  // ë¡œê·¸ì¸ ëª¨ë‹¬ & íšŒì›ê°€ì… ëª¨ë‹¬ ì œì–´ (loginTextëŠ” ì œì™¸!)
  const loginModal = document.getElementById('loginModal');
  const closeLoginBtn = document.getElementById('closeLoginModal');

  closeLoginBtn.addEventListener('click', () => loginModal.classList.remove('active'));
  loginModal.addEventListener('click', e => { if (e.target === loginModal) loginModal.classList.remove('active'); });

  const openSignupBtn = document.getElementById('openSignup');
  const signupModal = document.getElementById('signupModal');
  const closeSignupBtn = document.getElementById('closeSignupModal');

  openSignupBtn.addEventListener('click', () => {
    loginModal.classList.remove('active');
    signupModal.classList.add('active');
  });
  closeSignupBtn.addEventListener('click', () => signupModal.classList.remove('active'));
  signupModal.addEventListener('click', e => { if (e.target === signupModal) signupModal.classList.remove('active'); });
</script>

<script>
const loginForm = document.getElementById("loginForm");

loginForm.addEventListener("submit", async (e) => {
  e.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë§‰ê¸°

  const formData = new FormData(loginForm);
  const username = formData.get("username");
  const password = formData.get("password");

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const resultText = await res.text();

    if (resultText.includes("ì„±ê³µ")) {
      // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
      window.location.href = "/";
    } else {
      alert("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + resultText);
    }
  } catch (err) {
    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
    console.error(err);
  }
});
</script>


 

<script>
  window.addEventListener('DOMContentLoaded', async () => {
    const res = await fetch('/session-user');
    const data = await res.json();

    const loginText = document.getElementById('loginDisplay');
    const dropdown = document.getElementById('userDropdown');

    if (data.username) {
      loginText.textContent = `${data.username}ë‹˜`;
      loginText.style.cursor = 'pointer';

      loginText.addEventListener('click', () => {
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
      });

      document.addEventListener('click', (e) => {
        if (!loginText.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });

      document.getElementById('goMypage').addEventListener('click', () => {
        window.location.href = '/mypage.html';
      });

      document.getElementById('logoutBtn').addEventListener('click', () => {
        window.location.href = '/logout';
      });

    } else {
      loginText.addEventListener('click', () => {
        document.getElementById('loginModal').classList.add('active');
      });
    }
  });
</script>

<script>
  let savedLoc = {};

  document.getElementById('locBtn').onclick = () => {
    if (!navigator.geolocation) return alert('GPS ì§€ì› ì•ˆ ë¨');
    navigator.geolocation.getCurrentPosition(async pos => {
      const lat = pos.coords.latitude, lon = pos.coords.longitude;
      savedLoc = { lat, lon };
      document.getElementById('coords').textContent =
        `ìœ„ë„: ${lat.toFixed(6)}\nê²½ë„: ${lon.toFixed(6)}`;

      await fetch('/save_location', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ lat, lon, accuracy: pos.coords.accuracy })
      });

      document.getElementById('emotionDiv').style.display = 'block';
    }, () => alert('ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨'));
  };

  document.getElementById('emo').onchange = async () => {
    const emo = document.getElementById('emo').value;
    if (!emo) return;

    const res = await fetch('/recommend', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ emotion: emo })
    });
    const j = await res.json();
    const resultDiv = document.getElementById('result');
    if (!j.success) {
      resultDiv.innerHTML = `<p style="color:red;">ì¶”ì²œ ì‹¤íŒ¨: ${j.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</p>`;
      return;
    }

    let html = `<h2>ì¶”ì²œ íŠ¸ë™ (${j.tracks.length}ê°œ)</h2><ul>`;
    // ìµœëŒ€ 20ê°œê¹Œì§€
    j.tracks.forEach(track => {
      html += `
        <li>
          <a class="track-link" href="${track.audio}" target="_blank">
            ${track.name} â€” <em>${track.artist}</em>
          </a>
        </li>`;
    });
    html += `</ul>`;
    resultDiv.innerHTML = html;
  };
</script>


</body>
</html>
